<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<title>NOA</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f7fb;
  margin: 0;
  padding: 0;
}
.container {
  max-width: 700px;
  margin: 40px auto;
  background: #ffffff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  display: flex;
  flex-direction: column;
  height: 80vh;
}
.chat { flex: 1; overflow-y: auto; margin-bottom: 12px; }
.message { margin-bottom: 12px; padding: 12px; border-radius: 10px; white-space: pre-wrap; }
.noa { background: #f0f2f7; }
.user { background: #e0e7ff; text-align: right; }
textarea { width:100%; height:70px; padding:10px; border-radius:8px; }
button { width:100%; margin-top:8px; padding:14px; border:none; border-radius:8px; background:#1f3a8a; color:white; }
.reset { background:#c0392b; margin-bottom:10px; }
</style>
</head>

<body>
<div class="container">
<h1>NOA</h1>
<button id="resetBtn" class="reset">Reiniciar conversación</button>
<div id="chat" class="chat"></div>
<textarea id="input" placeholder="Escribe aquí..."></textarea>
<button id="sendBtn">Continuar</button>
</div>

<script>

let userId = localStorage.getItem("NOA_USER_ID");

if (!userId) {
  userId = "user_" + crypto.randomUUID();
  localStorage.setItem("NOA_USER_ID", userId);
}

const chat = document.getElementById("chat");
const input = document.getElementById("input");
const sendBtn = document.getElementById("sendBtn");
const resetBtn = document.getElementById("resetBtn");

function agregarMensaje(texto, clase) {
  const div = document.createElement("div");
  div.className = "message " + clase;
  div.textContent = texto;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

agregarMensaje("Estoy aquí contigo. Podemos comenzar cuando quieras.", "noa");

async function enviarMensaje() {
  const texto = input.value.trim();
  if (!texto) return;

  agregarMensaje("Tú:\n" + texto, "user");
  input.value = "";

  try {
    const response = await fetch("https://noa-server.onrender.com/chat", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        userId,
        mensaje: texto
      })
    });

    const data = await response.json();

    agregarMensaje("NOA:\n" + data.respuesta, "noa");

  } catch (error) {
    agregarMensaje("NOA:\nHubo un error al conectar con el servidor.", "noa");
  }
}

resetBtn.addEventListener("click", () => {
  location.reload();
});

sendBtn.addEventListener("click", enviarMensaje);

input.addEventListener("keydown", e => {
  if (e.key === "Enter" && !e.shiftKey) {
    e.preventDefault();
    enviarMensaje();
  }
});

</script>
</body>
</html>
